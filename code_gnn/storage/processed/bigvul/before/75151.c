static bool authenticated(conn *c) {
    assert(settings.sasl);
    bool rv = false;

    switch (c->cmd) {
    case PROTOCOL_BINARY_CMD_SASL_LIST_MECHS:  
    case PROTOCOL_BINARY_CMD_SASL_AUTH:        
    case PROTOCOL_BINARY_CMD_SASL_STEP:        
    case PROTOCOL_BINARY_CMD_VERSION:          
        rv = true;
        break;
    default:
        rv = c->authenticated;
    }

    if (settings.verbose > 1) {
        fprintf(stderr, "authenticated() in cmd 0x%02x is %s\n",
                c->cmd, rv ? "true" : "false");
    }

    return rv;
}
